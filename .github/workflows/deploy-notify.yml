name: Deploy Notification

on:
  push:
    branches: [main]

permissions: {}

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deployment via repository_dispatch
        env:
          GH_TOKEN: ${{ secrets.HADOKU_SITE_TOKEN }}
        run: |
          echo "Dispatching deploy event to hadoku_site..."

          gh api repos/WolffM/hadoku_site/dispatches \
            -X POST \
            -f event_type="deploy-vibedispatch" \
            -f 'client_payload[sha]=${{ github.sha }}' \
            -f 'client_payload[message]=${{ github.event.head_commit.message }}' \
            -f 'client_payload[ref]=${{ github.ref }}'

          echo "Deploy event dispatched successfully!"
